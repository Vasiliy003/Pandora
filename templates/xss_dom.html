<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DOM XSS — Тестовая страница</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --accent:#3b82f6;
      --muted:#6b7280;
      --danger:#ef4444;
      --radius:12px;
      --maxw:900px;
      --gap:16px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{
      background: linear-gradient(180deg, var(--bg), #eef2ff);
      padding: 48px 16px;
      display:flex;
      justify-content:center;
    }
    .container{
      width:100%;
      max-width:var(--maxw);
      display:grid;
      gap:var(--gap);
      align-items:start;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow: 0 6px 18px rgba(15,23,42,0.06);
      padding:20px;
    }
    form .row{ margin-bottom:12px; }
    label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px;}
    input[type="text"] {
      width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6e9f0;
      font-size:14px; background: #fbfcff;
      box-sizing:border-box;
    }
    .btn{
      display:inline-block; padding:10px 14px; border-radius:10px;
      background:var(--accent); color:white; font-weight:600; border:none;
      cursor:pointer; text-decoration:none;
    }
    .result-box{
      margin-top:16px; padding:16px;
      border-radius:10px;
      background:#fbfdff; border:1px solid #eef2ff;
    }
    .danger-note{ color:var(--danger); font-size:13px; margin-top:8px; }
    .timer { margin-left:10px; font-size:14px; color:#374151; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h2>DOM XSS — Поиск</h2>

      <form method="post">
        <div class="row">
          <label for="flag">Введите флаг</label>
          <input id="flag" name="flag" type="text" placeholder="Введите флаг">
          <div style="font-size:12px; color:var(--muted); margin-top:6px;">Найдите значение скрытого инпута secret</div>
        </div>

        <div class="row" style="display:flex; align-items:center; gap:10px;">
          <button type="submit" class="btn">Проверить</button>
          <div class="timer">⏱ Осталось: <span id="timer">00:00</span></div>
          <input type="hidden" name="time" value="0">
        </div>
      </form>

      <hr style="margin:16px 0; border:none; border-top:1px solid #f1f5f9;">
      <div class="row">
        <label for="query">Поисковый запрос</label>
        <input id="query" type="text" placeholder="Введите запрос...">
      </div>

      <button id="searchBtn" class="btn">Искать</button>

      <div id="results" class="result-box"></div>

      <input type="hidden" id="secret" value="{{ xss_flag }}">
    </div>
  </div>

  <script src="/static/timer.js"></script>

  <script>
    // --------------------------
    // ❌ УЯЗВИМОСТЬ: DOM XSS
    // --------------------------
    //
    // При нажатии на кнопку содержимое поля query
    // вставляется прямо в innerHTML.
    // Здесь НЕТ сервера, нет шаблона, нет Jinja.
    // Вся уязвимость — в JS.
    //
    const btn = document.getElementById('searchBtn');
    const results = document.getElementById('results');
    const queryInput = document.getElementById('query');

    btn.addEventListener('click', () => {
        const q = queryInput.value;

        // Уязвимый sink:
        results.innerHTML = `<b>Результат:</b> ${q}`;
    });

    // Дополнительно: если query передан в URL фрагменте (#)
    // например:  dom_xss.html#<img src=x onerror=alert(1)>
    if (location.hash) {
        const payload = decodeURIComponent(location.hash.substring(1));
        results.innerHTML = `<b>Авто-результат:</b> ${payload}`;
    }
  </script>
</body>
</html>
